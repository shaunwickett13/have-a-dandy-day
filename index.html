<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html;" charset="UTF-8" />
    <meta name="description" content="Wherever you are... whoever you are... have a dandy day!" />
    <meta name="keywords" content="dandy, day, positivity, greetings, well wishes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="theme-color" content="black" />

    <meta property="og:title" content="Have A Dandy Day!" />
    <meta property="og:url" content="https://haveadandyday.com" />
    <meta property="og:description" content="Wherever you are... whoever you are... have a dandy day!">
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://haveadandyday.com/image/share.png" />
    <meta property="og:image:alt" content="A man's head peeks out the bottom of the frame and there is text above him saying 'Have A Dandy Day!'" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1024" />
    <meta property="og:image:height" content="1024" />

    <link rel="apple-touch-icon" sizes="180x180" href="image/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="image/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="image/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa">
    <link rel="stylesheet" type="text/css" href="style.css" media="screen" />

    <script>
        function debounce(func, timeout = 50){
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }

        function setVhProperty () {
            document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
        }

        function initialize() {
            addEventListener("load", () => {
                if (window.location.href.includes("localhost")) {
                    const livejs = document.createElement("script");
                    livejs.setAttribute("src", "https://livejs.com/live.js")
                    livejs.setAttribute("type", "text/javascript")
                    document.head.appendChild(livejs)
                }

                if (!navigator.canShare || !navigator.canShare(DandyDayController.sharePayload)) {
                    document.getElementById("share-button").classList.add("hide")
                }
            })

            setVhProperty()
            addEventListener("resize", debounce(() => setVhProperty()))
        }

        class DandyDayController {
            static focusSchedule = [
                [3.5, "have"],
                [4.0, "a"],
                [4.5, "dan"],
                [4.75, "dy"],
                [5.0, "day"],
                [10.0, "have"],
                [10.5, "a"],
                [11, "dan"],
                [11.25, "dy"],
                [11.5, "day"],
                [23.0, "have"],
                [23.5, "a"],
                [24, "dan"],
                [24.25, "dy"],
                [24.5, "day"],
                [24.75, "have"],
                [25.25, "a"],
                [25.75, "dan"],
                [26, "dy"],
                [26.25, "day"],
            ]

            static sharePayload = {
                title: "Have A Dandy Day!",
                text: "Whoever you are... Wherever you are... have a dandy day!",
                url: "https://haveadandyday.com"
            }
            constructor() {}

            getAudio() {
                return document.getElementById("jingle")
            }

            handleAudioTimeUpdate() {
                const audioSampleTolerance = 500
                const {currentTime, duration} = this.getAudio()

                for (const [time, selector] of DandyDayController.focusSchedule) {
                    const timeUntilFocus = (time - currentTime) * 1000
                    if (timeUntilFocus <= audioSampleTolerance) {
                        setTimeout(() => document.querySelector(`#${selector}.word`).classList.add("focus"), timeUntilFocus)
                        setTimeout(() => document.querySelector(`#${selector}.word`).classList.remove("focus"), timeUntilFocus + 1000)
                    }
                }

                document.getElementById("progress-value").style.width = `${100 - ((currentTime / duration) * 100)}%`

                if (currentTime >= 25 && document.querySelectorAll(".firework").length === 0) {
                    const numFireworks = 8;
                    const body = document.querySelector("body")
                    Array.from(Array(numFireworks).keys()).map(i => {
                        const firework = document.createElement("div")
                        firework.classList.add("firework")
                        firework.classList.add(`f${i + 1}`)
                        return firework
                    }).forEach(firework => body.appendChild(firework))
                }
            }

            startExperience() {
                document.querySelector("body").classList.add("active")
                setTimeout(() => document.querySelector("#splash").classList.add("hide"), 1000)

                this.getAudio().play();
            }

            stopExperience() {
                document.getElementById("splash").classList.remove("hide")
                document.body.classList.remove("active")
                document.querySelectorAll('.firework').forEach(e => e.remove());

                this.getAudio().currentTime = 0
            }

            showLabel(element) {
                const label = document.querySelector(`label[for=${element.id}]`)
                label.classList.remove("hide")
            }

            hideLabel(element) {
                const label = document.querySelector(`label[for=${element.id}]`)
                label.classList.add("hide")
            }

            showSplash() {

            }

            showShare() {
                navigator.share(DandyDayController.sharePayload)
            }

            showQuote() {

            }

            showFaq() {

            }

            showAbout() {

            }
        }

        const dandyDayController = new DandyDayController();

        initialize()
    </script>

    <title>Have A Dandy Day!</title>
</head>
<body>
    <div id="splash" class="background-container">
        <button id="start-button" onclick="dandyDayController.startExperience()">start experience</button>
        <div id="additional">
            <div id="additional-buttons">
                <button id="share-button" onmouseenter="dandyDayController.showLabel(this)" onmouseleave="dandyDayController.hideLabel(this)" onclick="dandyDayController.showShare()" >share</button>
                <button id="quotes-button" onmouseenter="dandyDayController.showLabel(this)" onmouseleave="dandyDayController.hideLabel(this)" onclick="dandyDayController.showQuote()">quote</button>
                <button id="faq-button" onmouseenter="dandyDayController.showLabel(this)" onmouseleave="dandyDayController.hideLabel(this)" onclick="dandyDayController.showFaq()">faq</button>
                <button id="about-button" onmouseenter="dandyDayController.showLabel(this)" onmouseleave="dandyDayController.hideLabel(this)" onclick="dandyDayController.showAbout()">about</button>
            </div>
            <div id="additional-info">
                <label for="share-button" class="hide">share this site to brighten someone else's day</label>
                <label for="quotes-button" class="hide">get a fun quote from Dandy Dan himself</label>
                <label for="faq-button" class="hide">view the frequently asked questions</label>
                <label for="about-button" class="hide">view information about this site</label>
            </div>
        </div>
    </div>
    <div id="top-panel" class="background-container">
        <h1 id="greeting" class="shimmer">
            <span class="word" id="have">Have</span>
            <span class="word" id="a">A</span>
            <span class="word" id="dan">Dan</span><span class="word" id="dy">dy</span>
            <span class="word" id="day">Day!</span>
        </h1>
    </div>
    <div id="dandy-dan">
        <img class="dance" src="image/smile.png" alt="A smiling man wearing a bowling hat, a rainbow plaid blazer, and a fake moustache gives two thumbs up.">
    </div>
    <div id="bottom-panel" class="background-container">
        <div id="progress-bar">
            <div id="progress-value">
            </div>
        </div>
    </div>
    <div class="bg right"></div>
    <div class="bg right bg2"></div>
    <div class="bg right bg3"></div>
    <div class="bg left"></div>
    <div class="bg left bg4"></div>
    <div class="bg left bg5"></div>
    <audio id="jingle" preload="auto" onended="dandyDayController.stopExperience()" ontimeupdate="dandyDayController.handleAudioTimeUpdate()">
        <source src="audio/jingle.mp3" type="audio/mpeg" />
    </audio>
</body>
</html>